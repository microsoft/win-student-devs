# 3.6: Test automation tools

**Author: Nitya Narasimhan [@nitya](https://twitter.com/nitya)**

Welcome to Week 3, **Day 6** of #30DaysOfPWA. Want to learn more about this project? Check out our [Kickoff](../kickoff.md) post to learn about our roadmap and contributors. In today's post we'll talk about _Test Automation_ - what it is, why it matters, and developer tools to help us build reliable end-to-end testing workflows for our PWA.


![image of title and author.](_media/day-06.jpg)

### WHAT WE'LL COVER TODAY

| Section | Description |
| ------- | ----------- |
| **Test Automation** | What is it and why does it matter for modern web apps?|
|**Test Pyramid** | What does a testing strategy for modern web apps involve? |
|**Testing PWA** | What does a functional testing spec for PWA need? |
|**Hello, Playwright**| Reliable end-to-end test framework for modern web apps. |
|**Using Playwright** | Explore quickstarts, powerful tools, and PWA test scenarios |
|**Exercise**| Take Playwright for a spin with a sample PWA! |

---

## Test Automation

What is Test Automation? It's the practice of _executing tests automatically_ to validate the functionality and performance of a software product - and _using testing insights_ to iteratively improve the product quality. Test Automation is a key concept in modern DevOps culture with specific relevance to _continuous delivery_ - the use of build-deploy pipelines to maintain software products in a continuous state of readiness for production release. Test automation for PWA is currently driven by two factors: increasing test complexity, and richer tooling capability.


#### Test Complexity

Progressive Web Apps combine the reach of traditional web apps with the richer capability of platform-native apps (on supported browser and device platforms). This requires _cross-browser testing_ to ensure that web apps have a usable experience across all targeted modern browsers. And it requires a _progressive enhancement testing_ approach where more tests get unlocked on device platforms that support enhanced capabilities.

As testing _frequency_ grows (e.g., on every feature commit or bug fix) and testing _granularity_ increases (e.g., more browser and device configurations to validate behavior on), manual testing strategies become tedious, time-consuming and error-prone. In comparison, automated testing **reduces time** to detect issues (from days/weeks to seconds/minutes), **eliminates operator errors**, and **scales efficiently** with cloud computing support.

_We'll talk about a practical test pyramid and PWA testing scenarios in a later section._

#### Tooling Capability

Test automation for web apps is made easier by a growing set of tools and technology for _web automation_ - software that can execute user actions and perform other operations on a web browser without human intervention. Relevant technologies [for automated testing in Microsoft Edge](https://docs.microsoft.com/en-us/microsoft-edge/test-and-automation/test-and-automation) include:

 * _[Origin Trials](https://docs.microsoft.com/en-us/microsoft-edge/origin-trials/)_ - trial experimental APIs (e.g., web capabilities) on live sites with real users.
 * _[WebDriver](https://docs.microsoft.com/en-us/microsoft-edge/webdriver-chromium/?tabs=c-sharp)_ - a W3C standard wire protocol for out-of-process clients to remotely instruct browsers.
 * _[DevTools Protocol](https://docs.microsoft.com/en-us/microsoft-edge/devtools-protocol-chromium/)_ - directly inspect, debug, and profile,  Chromium-based browsers like Edge.
 * _[Puppeteer](https://docs.microsoft.com/en-us/microsoft-edge/puppeteer/)_ - a Node.js _library_ for browser automation using DevTools Protocol.
 * _[Playwright](https://docs.microsoft.com/en-us/microsoft-edge/playwright/)_ - _framework_ for reliable end-to-end testing of modern web apps, across browsers.
 * _[webhint](https://docs.microsoft.com/en-us/microsoft-edge/test-and-automation/webhint)_ - linter for accessibility, performance, security, PWA and cross-browser compatibility.


_We'll do a deeper dive into Playwright and its usage for automated cross-browser testing of PWA._


---

## Test Pyramid

So, how do we get started planning out our test automation strategy? 


First, we need to understand the _types_ of tests possible (defined by granularity and purpose), then use automation tools to orchestrate test execution workflows. 


In 2010, Mike Cohn [presented the concept](https://www.pearson.com/us/higher-education/program/Cohn-Succeeding-with-Agile-Software-Development-Using-Scrum/PGM201415.html) of a _test pyramid_ to jumpstart conversations on agile testing practices. The approach has been adapted and modified in many ways - but the visual metaphor still works as a way to balance test coverage with fast, flexible execution practices. In 2018, Martin Fowler described a [practical test pyramid](https://martinfowler.com/articles/practical-test-pyramid.html#TheImportanceOftestAutomation) that distills this to two guiding principles:
 * Write tests with different granularity
 * The more high-level you get, the fewer tests you should have.

While different test pyramid versions exist, here is my version for modern web apps, with level 0 at the base - and level 4 as the apex - of the pyramid.

| Level | Type | Description |
|:---|:---|:---|
| 4 | Exploratory Testing | _Manual testing_ (freeform, unstructured, creative) to uncover unforeseen issues, or test edge cases and experimental features. |
| 3 | End-to-End Testing| Tests complete application specification (all stories, all scripts) with realistic test data and measurable outcomes for validation. |
| 2 | UI Testing| Tests user interactions and workflow against a specified story. Validates behavior, layouts, usability, accessibility etc.|
| 1 | Integration Testing | Tests that multiple components work together as intended, where some are external depenendies for your application. |
| 0 | Unit Testing | Tests that an independent component of work functions as intended.|

The base should contain _many small tests that execute fast_ - think independent "units" that validate "micro" features or functionality. Every additional layer adds more complexity (in "system" integrations) and costs (in "service" activations) - so think _fewer, more coarse-grained_ tests that validate "macro" user stories and functionality with end-to-end workflows. Exploratory testing (apex) adds a manual creativity step to uncover issues that automated testing might miss.

Automating tests at lower layers is easier with numerous unit testing libraries and tools available to web developers today. Automated _end-to-end_ testing is more complex and ["notoriously flaky"](https://martinfowler.com/articles/practical-test-pyramid.html#TheImportanceOftestAutomation) given _browser quirks, timing issues, animations, unexpected UI interactions_ and more. In this post, we'll look at a testing framework (Playwright) that can mitigate these issues with reliable end-to-end testing and cross-browser automation support, as one solution.

---

## Testing PWA

Now let's talk about a _functional_ testing specification for Progressive Web Apps that you can use to create suitable unit tests and end-to-end testing workflows.

---

## Hello, Playwright!

![A Visual Introduction to the Playwright Testing Framework](_media/6-hello-playwright.jpg)

---

## Using Playwright

---

## Summary

---

## Exercise

We covered a lot today. Now it's your turn! Here are a few things you can try out:

* Look at your own PWA (or use one of the [sample PWA](https://docs.microsoft.com/en-us/microsoft-edge/progressive-web-apps-chromium/demo-pwas) projects) and instrument it to setup your first end-to-end test with Playwright.
* Add GitHub Actions to the project to automate test  execution on commits. Validate workflow with test commits. 
* Use the test generation tool (codegen) to create a custom test script from interactive user actions on your app. Customize it and automate execution by adding it to current test suite.
* Configure script for multiple browser (Chromium, WebKit, Firefox) and mobile (Emulator Device Profiles) targets - capture screenshots to validate responsive user experience.
* Configure script to turn on tracing - execute a test run, then use the HTML reporter and trace viewer tools to analyze your test performance.

---

## Resources

1. [The Practical Test Pyramid](https://martinfowler.com/articles/practical-test-pyramid.html#TheImportanceOftestAutomation) - Martin Fowler, Feb 2018
2. [Cross Browser Testing](https://developer.mozilla.org/en-US/docs/Learn/Tools_and_testing/Cross_browser_testing) - MDN Web Docs
3. [Playwright Docs](https://playwright.dev) - Reliable E2E Testing Framework for modern web apps
4. [MS Edge DevTools Protocol](https://docs.microsoft.com/en-us/microsoft-edge/devtools-protocol-chromium/) - Instrument, inspect, debug & profile browsers.
5. [MS Edge: Automate with Playwright](https://docs.microsoft.com/en-us/microsoft-edge/playwright/) - run Microsoft Edge in headed mode, with Playwright
6. [Using Origin Trials in Microsoft Edge](https://docs.microsoft.com/en-us/microsoft-edge/origin-trials/) - early testing with experimental APIs
7. [PWA Checklist](https://web.dev/pwa-checklist/) - What makes a good PWA?
8. [Testing Service Workers](https://medium.com/dev-channel/testing-service-workers-318d7b016b19) - Chromium Dev Team, Mar 2017
9. [Implementing Feature Detection](https://developer.mozilla.org/en-US/docs/learn/tools_and_testing/cross_browser_testing/feature_detection) - writing feature detection tests

---